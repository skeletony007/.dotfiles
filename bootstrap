#!/usr/bin/env bash

[[ $(ansible localhost -m setup -a 'filter=ansible_os_family') =~ ansible_os_family\":\ \"([^\"]+)\" ]] || exit 1
all_packages="${BASH_REMATCH[1]}
$(< "$HOME/.dotfiles/packages-common")
$(< "$HOME/.dotfiles/packages-${BASH_REMATCH[1]}")"

places=("$HOME/personal/ansible-roles" "$HOME/.dotfiles")

for place in "${places[@]}"; do
    cd "$place" || exit 1

    ./install <(printf "$all_packages") || exit 1
done
