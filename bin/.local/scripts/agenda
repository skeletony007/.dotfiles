#!/usr/bin/env python3

import datetime
import os
import sys

calendar_dir = os.path.join(
    os.getenv("PERSONAL", os.path.expanduser("~")), "notes", "calendar"
)

days = 7
if len(sys.argv) == 2 and sys.argv[1].isdigit():
    days = int(sys.argv[1])

print(f"Agenda for next {days} days\n======================\n")

today = datetime.datetime.now().date()
seven_days_later = today + datetime.timedelta(days=days)

for note in sorted(os.listdir(calendar_dir)):
    note_date = os.path.splitext(note)[0]

    if len(note_date) == 8 and note_date.isdigit():
        note_date_dt = datetime.datetime.strptime(note_date, "%Y%m%d").date()

        if today <= note_date_dt <= seven_days_later:
            print(f"{note_date}\n========\n")

            with open(os.path.join(calendar_dir, note), "r") as file:
                print(file.read())
